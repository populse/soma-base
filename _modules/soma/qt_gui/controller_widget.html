
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>soma.qt_gui.controller_widget &#8212; Soma-base 5.1.0 documentation</title>
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css" />
    
    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">Soma-base 5.1.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">soma.qt_gui.controller_widget</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for soma.qt_gui.controller_widget</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1">#</span>
<span class="c1"># SOMA - Copyright (C) CEA, 2015</span>
<span class="c1"># Distributed under the terms of the CeCILL-B license, as published by</span>
<span class="c1"># the CEA-CNRS-INRIA. Refer to the LICENSE file or to</span>
<span class="c1"># http://www.cecill.info/licences/Licence_CeCILL-B_V1-en.html</span>
<span class="c1"># for details.</span>
<span class="c1">#</span>

<span class="c1"># System import</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">six</span>

<span class="c1"># Define the logger</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="c1"># Soma import</span>
<span class="kn">from</span> <span class="nn">soma.qt_gui</span> <span class="kn">import</span> <span class="n">qt_backend</span>
<span class="kn">from</span> <span class="nn">soma.qt_gui.qt_backend</span> <span class="kn">import</span> <span class="n">QtGui</span><span class="p">,</span> <span class="n">QtCore</span><span class="p">,</span> <span class="n">Qt</span>
<span class="kn">from</span> <span class="nn">soma.controller</span> <span class="kn">import</span> <span class="n">trait_ids</span>
<span class="kn">from</span> <span class="nn">soma.qt_gui.timered_widgets</span> <span class="kn">import</span> <span class="n">TimeredQLineEdit</span>
<span class="kn">from</span> <span class="nn">soma.functiontools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">soma.sorted_dictionary</span> <span class="kn">import</span> <span class="n">OrderedDict</span>
<span class="kn">from</span> <span class="nn">soma.functiontools</span> <span class="kn">import</span> <span class="n">SomaPartial</span>
<span class="kn">import</span> <span class="nn">weakref</span>
<span class="kn">from</span> <span class="nn">soma.utils.weak_proxy</span> <span class="kn">import</span> <span class="n">get_ref</span><span class="p">,</span> <span class="n">weak_proxy</span>
<span class="kn">import</span> <span class="nn">traits.api</span> <span class="k">as</span> <span class="nn">traits</span>
<span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">import</span> <span class="nn">sip</span>

<span class="c1"># Qt import</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">_fromUtf8</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QString</span><span class="o">.</span><span class="n">fromUtf8</span>
<span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
    <span class="n">_fromUtf8</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span>

<span class="n">qt_backend</span><span class="o">.</span><span class="n">set_qt_backend</span><span class="p">(</span><span class="n">compatible_qt5</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># setup notification in Qt GUI thread</span>
<span class="n">qt_backend</span><span class="o">.</span><span class="n">init_traitsui_handler</span><span class="p">()</span>


<div class="viewcode-block" id="ScrollControllerWidget"><a class="viewcode-back" href="../../../api.html#soma.qt_gui.controller_widget.ScrollControllerWidget">[docs]</a><span class="k">class</span> <span class="nc">ScrollControllerWidget</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">QScrollArea</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot; Class that create a widget to set the controller parameters.</span>

<span class="sd">    The widget is placed in a scroll area when large sets of parameters have</span>
<span class="sd">    to be tuned.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">live</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">hide_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">select_controls</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">disable_controller_widget</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">override_control_types</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">user_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">userlevel</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Method to initilaize the ScrollControllerWidget class.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        controller: derived Controller instance (mandatory)</span>
<span class="sd">            a class derived from the Controller class we want to parametrize</span>
<span class="sd">            with a widget.</span>
<span class="sd">        parent: QtGui.QWidget (optional, default None)</span>
<span class="sd">            the controller widget parent widget.</span>
<span class="sd">        name: (optional, default None)</span>
<span class="sd">            the name of this controller widget</span>
<span class="sd">        live: bool (optional, default False)</span>
<span class="sd">            if True, synchronize the edited values in the widget with the</span>
<span class="sd">            controller values on the fly,</span>
<span class="sd">            otherwise, wait synchronization instructions to update the</span>
<span class="sd">            controller values.</span>
<span class="sd">        hide_labels: bool (optional, default False)</span>
<span class="sd">            if True, don&#39;t show the labels associated with the controls</span>
<span class="sd">        select_controls: str (optional, default None)</span>
<span class="sd">            parameter to select specific conrtoller traits. Authorized options</span>
<span class="sd">            are &#39;inputs&#39; or &#39;outputs&#39;.</span>
<span class="sd">        disable_controller_widget: bool (optional, default False)</span>
<span class="sd">            if True disable the controller widget.</span>
<span class="sd">        override_control_types: dict (optional)</span>
<span class="sd">            if given, this is a &quot;factory&quot; dict assigning new controller editor</span>
<span class="sd">            types to some traits types.</span>
<span class="sd">        user_data: any type (optional)</span>
<span class="sd">            optional user data that can be accessed by individual control</span>
<span class="sd">            editors</span>
<span class="sd">        userlevel: int</span>
<span class="sd">            the current user level: some traits may be marked with a non-zero userlevel, and will only be visible if the ControllerWidget userlevel is more than (or equal) the trait level.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Inheritance</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ScrollControllerWidget</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">user_data</span> <span class="o">=</span> <span class="n">user_data</span>

        <span class="c1"># Allow the application to resize the scroll area items</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setWidgetResizable</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setSizePolicy</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Preferred</span><span class="p">,</span>
                           <span class="n">QtGui</span><span class="o">.</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Preferred</span><span class="p">)</span>

        <span class="c1"># Display a surounding box</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setFrameShape</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QFrame</span><span class="o">.</span><span class="n">StyledPanel</span><span class="p">)</span>

        <span class="c1"># Create the controller widget</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">controller_widget</span> <span class="o">=</span> <span class="n">ControllerWidget</span><span class="p">(</span>
            <span class="n">controller</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">live</span><span class="p">,</span> <span class="n">hide_labels</span><span class="p">,</span> <span class="n">select_controls</span><span class="p">,</span>
            <span class="n">override_control_types</span><span class="o">=</span><span class="n">override_control_types</span><span class="p">,</span> <span class="n">user_data</span><span class="o">=</span><span class="n">user_data</span><span class="p">,</span>
            <span class="n">userlevel</span><span class="o">=</span><span class="n">userlevel</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">controller_widget</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span><span class="o">.</span><span class="n">setContentsMargins</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">controller_widget</span><span class="o">.</span><span class="n">setSizePolicy</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Expanding</span><span class="p">,</span>
                                             <span class="n">QtGui</span><span class="o">.</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Preferred</span><span class="p">)</span>

        <span class="c1"># Enable / disabled the controller widget</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">controller_widget</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="ow">not</span> <span class="n">disable_controller_widget</span><span class="p">)</span>

        <span class="c1"># Set the controller widget in the scroll area</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">controller_widget</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># disconnect underlying ControllerWidget so that it can be deleted.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">controller_widget</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">userlevel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;controller_widget&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller_widget</span><span class="o">.</span><span class="n">userlevel</span>
        <span class="k">return</span> <span class="mi">0</span>

    <span class="nd">@userlevel</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">userlevel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;controller_widget&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">controller_widget</span><span class="o">.</span><span class="n">userlevel</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">update_controller</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">controller_widget</span><span class="o">.</span><span class="n">update_controller</span><span class="p">()</span></div>


<div class="viewcode-block" id="DeletableLineEdit"><a class="viewcode-back" href="../../../api.html#soma.qt_gui.controller_widget.DeletableLineEdit">[docs]</a><span class="k">class</span> <span class="nc">DeletableLineEdit</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QWidget</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot; Close button + line editor, used for modifiable key labels</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">userModification</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Signal</span><span class="p">()</span>
    <span class="n">buttonPressed</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Signal</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">DeletableLineEdit</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="n">layout</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">layout</span><span class="p">)</span>
        <span class="n">delete_button</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QToolButton</span><span class="p">()</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">delete_button</span><span class="p">)</span>
        <span class="c1"># Set the tool icons</span>
        <span class="n">icon</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QIcon</span><span class="p">()</span>
        <span class="n">icon</span><span class="o">.</span><span class="n">addPixmap</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QPixmap</span><span class="p">(</span>
            <span class="n">_fromUtf8</span><span class="p">(</span><span class="s2">&quot;:/soma_widgets_icons/delete&quot;</span><span class="p">)),</span>
            <span class="n">QtGui</span><span class="o">.</span><span class="n">QIcon</span><span class="o">.</span><span class="n">Normal</span><span class="p">,</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QIcon</span><span class="o">.</span><span class="n">Off</span><span class="p">)</span>
        <span class="n">delete_button</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">icon</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">line_edit</span> <span class="o">=</span> <span class="n">TimeredQLineEdit</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">line_edit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">line_edit</span><span class="o">.</span><span class="n">userModification</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">userModification</span><span class="p">)</span>
        <span class="n">delete_button</span><span class="o">.</span><span class="n">pressed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">buttonPressed</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">text</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_edit</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">setText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">line_edit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></div>


<div class="viewcode-block" id="ControllerWidget"><a class="viewcode-back" href="../../../api.html#soma.qt_gui.controller_widget.ControllerWidget">[docs]</a><span class="k">class</span> <span class="nc">ControllerWidget</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QWidget</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot; Class that create a widget to set the controller parameters.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Parameter to store the mapping between the string trait descriptions and</span>
    <span class="c1"># the associated control classes</span>
    <span class="n">_defined_controls</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">live</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">hide_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">select_controls</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">editable_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">override_control_types</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">user_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">userlevel</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Method to initilaize the ControllerWidget class.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        controller: derived Controller instance (mandatory)</span>
<span class="sd">            a class derived from the Controller class we want to parametrize</span>
<span class="sd">            with a widget.</span>
<span class="sd">        parent: QtGui.QWidget (optional, default None)</span>
<span class="sd">            the controller widget parent widget.</span>
<span class="sd">        name: (optional, default None)</span>
<span class="sd">            the name of this controller widget</span>
<span class="sd">        live: bool (optional, default False)</span>
<span class="sd">            if True, synchronize the edited values in the widget with the</span>
<span class="sd">            controller values on the fly,</span>
<span class="sd">            otherwise, wait the synchronization instruction to update the</span>
<span class="sd">            controller values.</span>
<span class="sd">        hide_labels: bool (optional, default False)</span>
<span class="sd">            if True, don&#39;t show the labels associated with the controls</span>
<span class="sd">        select_controls: str (optional, default None)</span>
<span class="sd">            parameter to select specific conrtoller traits. Authorized options</span>
<span class="sd">            are &#39;inputs&#39; or &#39;outputs&#39;.</span>
<span class="sd">        editable_labels: bool (optional, default False)</span>
<span class="sd">            if True, labels (trait keys) may be edited by the user, their</span>
<span class="sd">            modification will trigger a signal.</span>
<span class="sd">        override_control_types: dict (optional)</span>
<span class="sd">            if given, this is a &quot;factory&quot; dict assigning new controller editor</span>
<span class="sd">            types to some traits types.</span>
<span class="sd">        user_data: any type (optional)</span>
<span class="sd">            optional user data that can be accessed by individual control</span>
<span class="sd">            editors</span>
<span class="sd">        userlevel: int</span>
<span class="sd">            the current user level: some traits may be marked with a non-zero userlevel, and will only be visible if the ControllerWidget userlevel is more than (or equal) the trait level.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Inheritance</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ControllerWidget</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_userlevel</span> <span class="o">=</span> <span class="n">userlevel</span>

        <span class="k">if</span> <span class="n">override_control_types</span><span class="p">:</span>
            <span class="c1"># copy dict</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_defined_controls</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">_defined_controls</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_defined_controls</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">override_control_types</span><span class="p">)</span>

        <span class="n">QtCore</span><span class="o">.</span><span class="n">QResource</span><span class="o">.</span><span class="n">registerResource</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)),</span> <span class="s1">&#39;resources&#39;</span><span class="p">,</span> <span class="s1">&#39;widgets_icons.rcc&#39;</span><span class="p">))</span>

        <span class="c1"># Class parameters</span>
        <span class="k">if</span> <span class="n">controller</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;null controller&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">controller</span> <span class="ow">is</span> <span class="n">traits</span><span class="o">.</span><span class="n">Undefined</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;undefined controller&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">controller</span> <span class="o">=</span> <span class="n">controller</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">live</span> <span class="o">=</span> <span class="n">live</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hide_labels</span> <span class="o">=</span> <span class="n">hide_labels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">select_controls</span> <span class="o">=</span> <span class="n">select_controls</span>
        <span class="c1"># Parameter to store the connection status between the</span>
        <span class="c1"># controller widget and the controller</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connected</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># Parameter to store all the controller widget controls:</span>
        <span class="c1"># the keys correspond to the control name (a control name is</span>
        <span class="c1"># associated to a controller trait with the same name), the</span>
        <span class="c1"># dictionary elements are 4-uplets of the form (trait, control_class,</span>
        <span class="c1"># control_instance, control_label).</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_controls</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_keys_connections</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">editable_labels</span> <span class="o">=</span> <span class="n">editable_labels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user_data</span> <span class="o">=</span> <span class="n">user_data</span>

        <span class="c1"># If possilbe, set the widget name</span>
        <span class="k">if</span> <span class="n">name</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="c1"># Create the layout of the controller widget</span>
        <span class="c1"># We will add all the controls to this layout</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_grid_layout</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QGridLayout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_grid_layout</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignTop</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_grid_layout</span><span class="o">.</span><span class="n">setSpacing</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_grid_layout</span><span class="o">.</span><span class="n">setContentsMargins</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_grid_layout</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_groups</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>

        <span class="c1"># Create all the layout controls associated with the controller values</span>
        <span class="c1"># we want to tune (ie the user traits)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_create_controls</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect_keys</span><span class="p">()</span>

        <span class="c1"># Start the event loop that check for wrong edited fields (usefull</span>
        <span class="c1"># when we work off line, otherwise the traits make the job but it is</span>
        <span class="c1"># still user friendly).</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check</span><span class="p">()</span>

        <span class="c1"># Set the synchrinization between this object and the input controller:</span>
        <span class="c1"># 1) synchronize the edited values in the widget with the controller</span>
        <span class="c1"># values on the fly</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">live</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>

        <span class="c1"># 2) initialize the controller widget with the controller values and</span>
        <span class="c1"># wait synchronization instructions to update the controller values.</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_controller_widget</span><span class="p">()</span>

    <span class="c1">#</span>
    <span class="c1"># Public members</span>
    <span class="c1">#</span>

<div class="viewcode-block" id="ControllerWidget.is_valid"><a class="viewcode-back" href="../../../api.html#soma.qt_gui.controller_widget.ControllerWidget.is_valid">[docs]</a>    <span class="k">def</span> <span class="nf">is_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Check that all edited fields are correct.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        valid: bool</span>
<span class="sd">            True if all the controller widget controls are correctly filled,</span>
<span class="sd">            False otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Initilaized the output</span>
        <span class="n">valid</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># Go through all the controller widget controls</span>
        <span class="k">for</span> <span class="n">control_name</span><span class="p">,</span> <span class="n">control_groups</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_controls</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">group_name</span><span class="p">,</span> <span class="n">control</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="n">control_groups</span><span class="p">):</span>

                <span class="c1"># Unpack the control item</span>
                <span class="n">trait</span><span class="p">,</span> <span class="n">control_class</span><span class="p">,</span> <span class="n">control_instance</span><span class="p">,</span> <span class="n">control_label</span> <span class="o">=</span> <span class="n">control</span>

                <span class="c1"># Call the current control specific check method</span>
                <span class="n">valid</span> <span class="o">=</span> <span class="n">control_class</span><span class="o">.</span><span class="n">is_valid</span><span class="p">(</span><span class="n">control_instance</span><span class="p">)</span>

                <span class="c1"># Stop checking if a wrong control has been found</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">valid</span><span class="p">:</span>
                    <span class="k">break</span>

        <span class="k">return</span> <span class="n">valid</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">userlevel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_userlevel</span>

    <span class="nd">@userlevel</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">userlevel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_userlevel</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_controls</span><span class="p">()</span>

<div class="viewcode-block" id="ControllerWidget.update_controller"><a class="viewcode-back" href="../../../api.html#soma.qt_gui.controller_widget.ControllerWidget.update_controller">[docs]</a>    <span class="k">def</span> <span class="nf">update_controller</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Update the controller.</span>

<span class="sd">        At the end the controller traits values will match the controller</span>
<span class="sd">        widget user defined parameters.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Go through all the controller widget controls</span>
        <span class="k">for</span> <span class="n">control_name</span><span class="p">,</span> <span class="n">control_groups</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_controls</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">group_name</span><span class="p">,</span> <span class="n">control</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="n">control_groups</span><span class="p">):</span>

                <span class="c1"># Unpack the control item</span>
                <span class="n">trait</span><span class="p">,</span> <span class="n">control_class</span><span class="p">,</span> <span class="n">control_instance</span><span class="p">,</span> <span class="n">control_label</span> <span class="o">=</span> <span class="n">control</span>

                <span class="c1"># Call the current control specific update controller method</span>
                <span class="n">control_class</span><span class="o">.</span><span class="n">update_controller</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">control_name</span><span class="p">,</span>
                                                <span class="n">control_instance</span><span class="p">)</span></div>

<div class="viewcode-block" id="ControllerWidget.update_controller_widget"><a class="viewcode-back" href="../../../api.html#soma.qt_gui.controller_widget.ControllerWidget.update_controller_widget">[docs]</a>    <span class="k">def</span> <span class="nf">update_controller_widget</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Update the controller widget.</span>

<span class="sd">        At the end the controller widget user editable parameters will match</span>
<span class="sd">        the controller traits values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Go through all the controller widget controls</span>
        <span class="k">for</span> <span class="n">control_name</span><span class="p">,</span> <span class="n">control_groups</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_controls</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">group_name</span><span class="p">,</span> <span class="n">control</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="n">control_groups</span><span class="p">):</span>

                <span class="c1"># Unpack the control item</span>
                <span class="n">trait</span><span class="p">,</span> <span class="n">control_class</span><span class="p">,</span> <span class="n">control_instance</span><span class="p">,</span> <span class="n">control_label</span> <span class="o">=</span> <span class="n">control</span>

                <span class="c1"># Call the current control specific update controller widget</span>
                <span class="c1"># method</span>
                <span class="n">control_class</span><span class="o">.</span><span class="n">update_controller_widget</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">control_name</span><span class="p">,</span>
                                                      <span class="n">control_instance</span><span class="p">)</span></div>

<div class="viewcode-block" id="ControllerWidget.connect"><a class="viewcode-back" href="../../../api.html#soma.qt_gui.controller_widget.ControllerWidget.connect">[docs]</a>    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Connect the controller trait and the controller widget controls</span>

<span class="sd">        At the end al control will be connected with the associated trait, and</span>
<span class="sd">        when a &#39;user_traits_changed&#39; signal is emited, the controls are updated</span>
<span class="sd">        (ie, deleted if necessary).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># If the controller and controller widget are not yet connected</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">connected</span><span class="p">:</span>

            <span class="c1"># Go through all the controller widget controls</span>
            <span class="k">for</span> <span class="n">control_name</span><span class="p">,</span> <span class="n">control_groups</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_controls</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">group_name</span><span class="p">,</span> <span class="n">control</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="n">control_groups</span><span class="p">):</span>

                    <span class="c1"># Unpack the control item</span>
                    <span class="n">trait</span><span class="p">,</span> <span class="n">control_class</span><span class="p">,</span> <span class="n">control_instance</span><span class="p">,</span> <span class="n">control_label</span> \
                        <span class="o">=</span> <span class="n">control</span>

                    <span class="c1"># Call the current control specific connection method</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Connecting control &#39;</span><span class="si">{0}</span><span class="s2">: </span><span class="si">{1}</span><span class="s2">&#39;...&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">control_name</span><span class="p">,</span> <span class="n">control_instance</span><span class="p">))</span>
                    <span class="n">control_class</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">control_name</span><span class="p">,</span> <span class="n">control_instance</span><span class="p">)</span>

            <span class="c1"># Add an event connected with the &#39;user_traits_changed&#39; controller</span>
            <span class="c1"># signal: update the controls</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">on_trait_change</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">update_controls</span><span class="p">,</span> <span class="s2">&quot;user_traits_changed&quot;</span><span class="p">,</span> <span class="n">dispatch</span><span class="o">=</span><span class="s1">&#39;ui&#39;</span><span class="p">)</span>

            <span class="c1"># if &#39;visible_groups&#39; is a trait, connect it to groups</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">trait</span><span class="p">(</span><span class="s1">&#39;visible_groups&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">on_trait_change</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">groups_vibility_changed</span><span class="p">,</span> <span class="s1">&#39;visible_groups&#39;</span><span class="p">,</span>
                    <span class="n">dispatch</span><span class="o">=</span><span class="s1">&#39;ui&#39;</span><span class="p">)</span>

            <span class="c1"># Update the controller widget values</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_controller_widget</span><span class="p">()</span>

            <span class="c1"># notifications should be removed when the GUI is destroyed</span>
            <span class="c1"># (on C++ side)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">destroyed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
                <span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">static_disconnect</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">update_controls</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">groups_vibility_changed</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_controls</span><span class="p">))</span>
            <span class="c1"># Update the connection status</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connected</span> <span class="o">=</span> <span class="kc">True</span></div>

    <span class="k">def</span> <span class="nf">connect_keys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">editable_labels</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_keys_connections</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">keys_connect</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># Go through all the controller widget controls</span>
        <span class="k">for</span> <span class="n">control_name</span><span class="p">,</span> <span class="n">control_groups</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_controls</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">group_name</span><span class="p">,</span> <span class="n">control</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="n">control_groups</span><span class="p">):</span>
                <span class="n">hook1</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">_key_modified</span><span class="p">,</span>
                                <span class="n">weakref</span><span class="o">.</span><span class="n">proxy</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">control_name</span><span class="p">)</span>
                <span class="n">hook2</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">_delete_key</span><span class="p">,</span>
                                <span class="n">weakref</span><span class="o">.</span><span class="n">proxy</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">control_name</span><span class="p">)</span>
                <span class="c1">#control = self._controls[control_name]</span>
                <span class="n">label_control</span> <span class="o">=</span> <span class="n">control</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">label_control</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                    <span class="n">label_control</span> <span class="o">=</span> <span class="n">label_control</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">label_control</span><span class="o">.</span><span class="n">userModification</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">hook1</span><span class="p">)</span>
                <span class="n">label_control</span><span class="o">.</span><span class="n">buttonPressed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">hook2</span><span class="p">)</span>
                <span class="n">keys_connect</span><span class="p">[</span><span class="n">control_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">label_control</span><span class="p">,</span> <span class="n">hook1</span><span class="p">,</span> <span class="n">hook2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_keys_connections</span> <span class="o">=</span> <span class="n">keys_connect</span>

<div class="viewcode-block" id="ControllerWidget.static_disconnect"><a class="viewcode-back" href="../../../api.html#soma.qt_gui.controller_widget.ControllerWidget.static_disconnect">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">static_disconnect</span><span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="n">update_controls</span><span class="p">,</span> <span class="n">groups_vibility_changed</span><span class="p">,</span>
                          <span class="n">controls</span><span class="p">,</span> <span class="n">widget</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; disconnect() cannot be called at the right time.</span>
<span class="sd">        static_disconnect() is called via a Qt signat when the widget is</span>
<span class="sd">        destroyed. But the python part is already destroyed then.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">controller</span><span class="o">.</span><span class="n">on_trait_change</span><span class="p">(</span>
            <span class="n">update_controls</span><span class="p">,</span> <span class="s2">&quot;user_traits_changed&quot;</span><span class="p">,</span> <span class="n">remove</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># if &#39;visible_groups&#39; is a trait, connect it to groups</span>
        <span class="k">if</span> <span class="n">controller</span><span class="o">.</span><span class="n">trait</span><span class="p">(</span><span class="s1">&#39;visible_groups&#39;</span><span class="p">):</span>
            <span class="n">controller</span><span class="o">.</span><span class="n">on_trait_change</span><span class="p">(</span>
                <span class="n">groups_vibility_changed</span><span class="p">,</span> <span class="s1">&#39;visible_groups&#39;</span><span class="p">,</span> <span class="n">remove</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Go through all the controller widget controls</span>
        <span class="k">for</span> <span class="n">control_name</span><span class="p">,</span> <span class="n">control_groups</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="n">controls</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">group_name</span><span class="p">,</span> <span class="n">control</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="n">control_groups</span><span class="p">):</span>

                <span class="c1"># Unpack the control item</span>
                <span class="n">trait</span><span class="p">,</span> <span class="n">control_class</span><span class="p">,</span> <span class="n">control_instance</span><span class="p">,</span> <span class="n">control_label</span> \
                    <span class="o">=</span> <span class="n">control</span>

                <span class="c1"># Call the current control specific disconnection method</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">control_class</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">control_name</span><span class="p">,</span>
                                             <span class="n">control_instance</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="k">pass</span>  <span class="c1"># probably something already deleted</span></div>

<div class="viewcode-block" id="ControllerWidget.disconnect"><a class="viewcode-back" href="../../../api.html#soma.qt_gui.controller_widget.ControllerWidget.disconnect">[docs]</a>    <span class="k">def</span> <span class="nf">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Disconnect the controller trait and the controller widget controls</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># If the controller and controller widget are connected</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">connected</span><span class="p">:</span>

            <span class="c1"># Remove the &#39;update_controls&#39; event connected with the</span>
            <span class="c1"># &#39;user_traits_changed&#39; controller signal</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">on_trait_change</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">update_controls</span><span class="p">,</span> <span class="s2">&quot;user_traits_changed&quot;</span><span class="p">,</span> <span class="n">remove</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># if &#39;visible_groups&#39; is a trait, connect it to groups</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">trait</span><span class="p">(</span><span class="s1">&#39;visible_groups&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">on_trait_change</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">groups_vibility_changed</span><span class="p">,</span> <span class="s1">&#39;visible_groups&#39;</span><span class="p">,</span>
                    <span class="n">remove</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># Go through all the controller widget controls</span>
            <span class="k">for</span> <span class="n">control_name</span><span class="p">,</span> <span class="n">control_groups</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_controls</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">group_name</span><span class="p">,</span> <span class="n">control</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="n">control_groups</span><span class="p">):</span>

                    <span class="c1"># Unpack the control item</span>
                    <span class="n">trait</span><span class="p">,</span> <span class="n">control_class</span><span class="p">,</span> <span class="n">control_instance</span><span class="p">,</span> <span class="n">control_label</span> \
                        <span class="o">=</span> <span class="n">control</span>

                    <span class="c1"># Call the current control specific disconnection method</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">control_class</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">control_name</span><span class="p">,</span>
                                                 <span class="n">control_instance</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                        <span class="k">pass</span>  <span class="c1"># probably something already deleted</span>

            <span class="c1"># Update the connection status</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connected</span> <span class="o">=</span> <span class="kc">False</span></div>

    <span class="k">def</span> <span class="nf">disconnect_keys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">control_name</span><span class="p">,</span> <span class="n">connections</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_keys_connections</span><span class="p">):</span>
            <span class="n">label_widget</span><span class="p">,</span> <span class="n">hook1</span><span class="p">,</span> <span class="n">hook2</span> <span class="o">=</span> <span class="n">connections</span>
            <span class="n">label_widget</span><span class="o">.</span><span class="n">userModification</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span><span class="n">hook1</span><span class="p">)</span>
            <span class="n">label_widget</span><span class="o">.</span><span class="n">buttonPressed</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span><span class="n">hook2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_keys_connections</span> <span class="o">=</span> <span class="p">{}</span>

<div class="viewcode-block" id="ControllerWidget.update_controls"><a class="viewcode-back" href="../../../api.html#soma.qt_gui.controller_widget.ControllerWidget.update_controls">[docs]</a>    <span class="k">def</span> <span class="nf">update_controls</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Event to refresh controller widget controls and intern parameters.</span>

<span class="sd">        The refresh is done off line, ie. we need first to disconnect the</span>
<span class="sd">        controller and the controller widget.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Get the controller traits</span>
        <span class="n">user_traits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">user_traits</span><span class="p">()</span>

        <span class="c1"># Assess the refreshing is done off line</span>
        <span class="n">was_connected</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connected</span>
        <span class="k">if</span> <span class="n">was_connected</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disconnect_keys</span><span class="p">()</span>

        <span class="c1"># Go through all the controller widget controls</span>
        <span class="n">to_remove_controls</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">control_name</span><span class="p">,</span> <span class="n">control_groups</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_controls</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">group_name</span><span class="p">,</span> <span class="n">control</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="n">control_groups</span><span class="p">):</span>

                <span class="c1"># Message</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                    <span class="s2">&quot;Check if we need to update &#39;</span><span class="si">{0}</span><span class="s2">&#39;: trait in &#39;</span><span class="si">{1}</span><span class="s2">&#39; &quot;</span>
                    <span class="s2">&quot;different from &#39;</span><span class="si">{2}</span><span class="s2">&#39;?&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">control_name</span><span class="p">,</span> <span class="n">control</span><span class="p">,</span> <span class="n">user_traits</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">control_name</span><span class="p">)))</span>

                <span class="c1"># Unpack the control item</span>
                <span class="n">trait</span><span class="p">,</span> <span class="n">control_class</span><span class="p">,</span> <span class="n">control_instance</span><span class="p">,</span> <span class="n">control_label</span> <span class="o">=</span> <span class="n">control</span>

                <span class="c1"># If the the controller trait is different from the trait</span>
                <span class="c1"># associated with the control</span>
                <span class="k">if</span> <span class="n">user_traits</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">control_name</span><span class="p">)</span> <span class="o">!=</span> <span class="n">trait</span><span class="p">:</span>

                    <span class="c1"># Close and schedule for deletation the control widget</span>
                    <span class="n">control_instance</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                    <span class="n">control_instance</span><span class="o">.</span><span class="n">deleteLater</span><span class="p">()</span>

                    <span class="c1"># Close and schedule for deletation the control labels</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">control_label</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                        <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">control_label</span><span class="p">:</span>
                            <span class="k">if</span> <span class="ow">not</span> <span class="n">sip</span><span class="o">.</span><span class="n">isdeleted</span><span class="p">(</span><span class="n">label</span><span class="p">):</span>
                                <span class="n">label</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                                <span class="n">label</span><span class="o">.</span><span class="n">deleteLater</span><span class="p">()</span>
                    <span class="k">elif</span> <span class="n">control_label</span><span class="p">:</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">sip</span><span class="o">.</span><span class="n">isdeleted</span><span class="p">(</span><span class="n">control_label</span><span class="p">):</span>
                            <span class="n">control_label</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                            <span class="n">control_label</span><span class="o">.</span><span class="n">deleteLater</span><span class="p">()</span>

                    <span class="c1"># Store the controls to be removed</span>
                    <span class="n">to_remove_controls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">control_name</span><span class="p">)</span>

        <span class="c1"># Delete all dead controls from the class &#39;_controls&#39; intern parameter</span>
        <span class="k">for</span> <span class="n">control_name</span> <span class="ow">in</span> <span class="n">to_remove_controls</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Delete control &#39;</span><span class="si">{0}</span><span class="s2">&#39;.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">control_name</span><span class="p">))</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_controls</span><span class="p">[</span><span class="n">control_name</span><span class="p">]</span>

        <span class="c1"># Recreate all the layout controls associated with the controller</span>
        <span class="c1"># values we want to tune (ie the user_traits): this procedure check</span>
        <span class="c1"># if the control has not already been created.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_create_controls</span><span class="p">()</span>

        <span class="c1"># Restore the connection status</span>
        <span class="k">if</span> <span class="n">was_connected</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect_keys</span><span class="p">()</span>

        <span class="c1"># Update the widget geometry</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateGeometry</span><span class="p">()</span></div>

    <span class="c1">#</span>
    <span class="c1"># Private members</span>
    <span class="c1">#</span>

    <span class="k">def</span> <span class="nf">_check</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Check that all edited fields are correct.</span>

<span class="sd">        At the end the controls with wrong values will be colored in red.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Go through all the controller widget controls</span>
        <span class="k">for</span> <span class="n">control_name</span><span class="p">,</span> <span class="n">control_groups</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_controls</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">group_name</span><span class="p">,</span> <span class="n">control</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="n">control_groups</span><span class="p">):</span>

                <span class="c1"># Unpack the control item</span>
                <span class="n">trait</span><span class="p">,</span> <span class="n">control_class</span><span class="p">,</span> <span class="n">control_instance</span><span class="p">,</span> <span class="n">control_label</span> <span class="o">=</span> <span class="n">control</span>

                <span class="c1"># Call the current control specific check method</span>
                <span class="n">control_class</span><span class="o">.</span><span class="n">check</span><span class="p">(</span><span class="n">control_instance</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_create_controls</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Method that will create a control for each user trait of the</span>
<span class="sd">        controller.</span>

<span class="sd">        Controller trait parameters that cannot be maped to controls</span>
<span class="sd">        will not appear in the user interface.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Select only the controller traits of interest</span>
        <span class="n">all_traits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">user_traits</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_controls</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">selected_traits</span> <span class="o">=</span> <span class="n">all_traits</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_controls</span> <span class="o">==</span> <span class="s2">&quot;inputs&quot;</span><span class="p">:</span>
            <span class="n">selected_traits</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="p">(</span><span class="n">trait_name</span><span class="p">,</span> <span class="n">trait</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">trait_name</span><span class="p">,</span> <span class="n">trait</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="n">all_traits</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">trait</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_controls</span> <span class="o">==</span> <span class="s2">&quot;outputs&quot;</span><span class="p">:</span>
            <span class="n">selected_traits</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="p">(</span><span class="n">trait_name</span><span class="p">,</span> <span class="n">trait</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">trait_name</span><span class="p">,</span> <span class="n">trait</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="n">all_traits</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">trait</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;Unrecognized &#39;select_controls&#39; option &#39;</span><span class="si">{0}</span><span class="s2">&#39;. Valid &quot;</span>
                <span class="s2">&quot;options are &#39;inputs&#39; or &#39;outputs&#39;.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">select_controls</span><span class="p">))</span>

        <span class="c1"># Go through all the controller user traits</span>
        <span class="n">skipped</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;visible_groups&#39;</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">trait_name</span><span class="p">,</span> <span class="n">trait</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="n">selected_traits</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">trait_name</span> <span class="ow">in</span> <span class="n">skipped</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="c1"># Create the widget</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_control</span><span class="p">(</span><span class="n">trait_name</span><span class="p">,</span> <span class="n">trait</span><span class="p">)</span>

<div class="viewcode-block" id="ControllerWidget.create_control"><a class="viewcode-back" href="../../../api.html#soma.qt_gui.controller_widget.ControllerWidget.create_control">[docs]</a>    <span class="k">def</span> <span class="nf">create_control</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trait_name</span><span class="p">,</span> <span class="n">trait</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Create a control associated to a trait.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        trait_name: str (mandatory)</span>
<span class="sd">            the name of the trait from which we want to create a control. The</span>
<span class="sd">            control widget will share the same name</span>
<span class="sd">        trait: Trait (mandatory)</span>
<span class="sd">            a trait item</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Search if the current trait has already been processed</span>
        <span class="n">control_groups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_controls</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">trait_name</span><span class="p">)</span>
        <span class="n">control_instances</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">control_labels</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># If no control has been found in the class intern parameters</span>
        <span class="k">if</span> <span class="n">control_groups</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

            <span class="c1"># Call the search function that will map the trait type to the</span>
            <span class="c1"># corresponding control type</span>
            <span class="n">control_class</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_control_class</span><span class="p">(</span><span class="n">trait</span><span class="p">)</span>

            <span class="c1"># If no control has been found, skip this trait and print</span>
            <span class="c1"># an error message. Note that the parameter will not be</span>
            <span class="c1"># accessible in the user interface.</span>
            <span class="k">if</span> <span class="n">control_class</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                    <span class="s2">&quot;No control defined for trait &#39;</span><span class="si">{0}</span><span class="s2">&#39;: </span><span class="si">{1}</span><span class="s2">. This &quot;</span>
                    <span class="s2">&quot;parameter will not be accessible in the &quot;</span>
                    <span class="s2">&quot;user interface.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">trait_name</span><span class="p">,</span> <span class="n">trait_ids</span><span class="p">(</span><span class="n">trait</span><span class="p">)))</span>
                <span class="k">return</span>

            <span class="c1"># handle groups</span>
            <span class="n">layouts</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">groups</span> <span class="o">=</span> <span class="n">trait</span><span class="o">.</span><span class="n">groups</span>
            <span class="k">if</span> <span class="n">groups</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">:</span>
                    <span class="n">group_widget</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_groups</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">group_widget</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">group_widget</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_group_widget</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_groups</span><span class="p">[</span><span class="n">group</span><span class="p">]</span> <span class="o">=</span> <span class="n">group_widget</span>
                    <span class="n">layouts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">group_widget</span><span class="o">.</span><span class="n">hideable_widget</span><span class="o">.</span><span class="n">layout</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">layouts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_grid_layout</span><span class="p">)</span>

            <span class="n">group</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">layout</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">layouts</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">groups</span><span class="p">:</span>
                    <span class="n">group</span> <span class="o">=</span> <span class="n">groups</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">control_instance</span><span class="p">,</span> <span class="n">control_label</span> \
                      <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_control_in_layout</span><span class="p">(</span><span class="n">trait_name</span><span class="p">,</span> <span class="n">trait</span><span class="p">,</span>
                                                       <span class="n">layout</span><span class="p">,</span> <span class="n">group</span><span class="p">)</span>
                <span class="n">control_instances</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">control_instance</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">control_label</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">control_label</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                        <span class="n">control_label</span> <span class="o">=</span> <span class="p">[</span><span class="n">control_label</span><span class="p">]</span>
                    <span class="n">control_labels</span> <span class="o">+=</span> <span class="nb">list</span><span class="p">(</span><span class="n">control_label</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">control_label</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">):</span>
                        <span class="n">control_label</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">setTextInteractionFlags</span><span class="p">(</span>
                            <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">TextSelectableByKeyboard</span> <span class="o">|</span>
                            <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">TextSelectableByMouse</span><span class="p">)</span>
                    <span class="n">control_label</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">setContextMenuPolicy</span><span class="p">(</span>
                        <span class="n">Qt</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">CustomContextMenu</span><span class="p">)</span>
                    <span class="n">control_label</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">customContextMenuRequested</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
                        <span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_label_context_menu</span><span class="p">,</span>
                                <span class="n">weakref</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="n">control_label</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">trait_name</span><span class="p">))</span>

        <span class="c1"># Otherwise, the control associated with the current trait name is</span>
        <span class="c1"># already inserted in the grid layout, just unpack the values</span>
        <span class="c1"># contained in the private &#39;_controls&#39; class parameter</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">group</span><span class="p">,</span> <span class="n">control</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="n">control_groups</span><span class="p">):</span>
                <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">control_instance</span><span class="p">,</span> <span class="n">control_label</span> <span class="o">=</span> <span class="n">control</span>
                <span class="n">control_instances</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">control_instance</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">control_label</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">control_label</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                        <span class="n">control_labels</span> <span class="o">+=</span> <span class="nb">list</span><span class="p">(</span><span class="n">control_label</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">control_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">control_label</span><span class="p">)</span>

        <span class="c1"># Each trait has a hidden property. Take care of this information</span>
        <span class="n">hide</span> <span class="o">=</span> <span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">trait</span><span class="p">,</span> <span class="s1">&#39;hidden&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
                <span class="ow">or</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">trait</span><span class="p">,</span> <span class="s1">&#39;unused&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
                <span class="ow">or</span> <span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">trait</span><span class="p">,</span> <span class="s1">&#39;userlevel&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                    <span class="ow">and</span> <span class="n">trait</span><span class="o">.</span><span class="n">userlevel</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">userlevel</span><span class="p">))</span>

        <span class="c1"># Show/Hide the control and associated labels</span>
        <span class="k">for</span> <span class="n">control_instance</span> <span class="ow">in</span> <span class="n">control_instances</span><span class="p">:</span>
            <span class="n">control_instance</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="ow">not</span> <span class="n">hide</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">control_labels</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">sip</span><span class="o">.</span><span class="n">isdeleted</span><span class="p">(</span><span class="n">label</span><span class="p">):</span>  <span class="c1"># sometimes happens...</span>
                <span class="n">label</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="ow">not</span> <span class="n">hide</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_create_group_widget</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group</span><span class="p">):</span>
        <span class="n">group_widget</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QGroupBox</span><span class="p">()</span>
        <span class="n">last_row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_grid_layout</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_grid_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">group_widget</span><span class="p">,</span> <span class="n">last_row</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                                    <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">lay1</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QVBoxLayout</span><span class="p">()</span>
        <span class="n">lay1</span><span class="o">.</span><span class="n">setContentsMargins</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">lay2</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="n">lay1</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">lay2</span><span class="p">)</span>
        <span class="n">lay2</span><span class="o">.</span><span class="n">setContentsMargins</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">lay2</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;&lt;html&gt;&lt;em&gt;</span><span class="si">%s</span><span class="s1">&lt;/em&gt;&lt;/html&gt;&#39;</span> <span class="o">%</span> <span class="n">group</span><span class="p">))</span>
        <span class="n">lay2</span><span class="o">.</span><span class="n">addStretch</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">icon</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QIcon</span><span class="p">()</span>
        <span class="n">icon</span><span class="o">.</span><span class="n">addPixmap</span><span class="p">(</span>
            <span class="n">QtGui</span><span class="o">.</span><span class="n">QPixmap</span><span class="p">(</span><span class="n">_fromUtf8</span><span class="p">(</span><span class="s2">&quot;:/soma_widgets_icons/nav_down&quot;</span><span class="p">)),</span>
            <span class="n">QtGui</span><span class="o">.</span><span class="n">QIcon</span><span class="o">.</span><span class="n">Normal</span><span class="p">,</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QIcon</span><span class="o">.</span><span class="n">Off</span><span class="p">)</span>
        <span class="n">group_widget</span><span class="o">.</span><span class="n">fold_button</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QPushButton</span><span class="p">(</span><span class="n">icon</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">group_widget</span><span class="o">.</span><span class="n">fold_button</span><span class="o">.</span><span class="n">setFixedSize</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
        <span class="n">lay2</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">group_widget</span><span class="o">.</span><span class="n">fold_button</span><span class="p">)</span>
        <span class="n">widget</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QWidget</span><span class="p">()</span>
        <span class="n">group_widget</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">lay1</span><span class="p">)</span>
        <span class="n">lay1</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>
        <span class="n">group_widget</span><span class="o">.</span><span class="n">hideable_widget</span> <span class="o">=</span> <span class="n">widget</span>
        <span class="n">layout</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QGridLayout</span><span class="p">()</span>
        <span class="n">widget</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">layout</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignTop</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">setSpacing</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">setContentsMargins</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">group_widget</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignLeft</span><span class="p">)</span>

        <span class="n">visible_groups</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="p">,</span> <span class="s1">&#39;visible_groups&#39;</span><span class="p">,</span> <span class="nb">set</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">visible_groups</span><span class="p">:</span>
            <span class="n">show</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">show</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">group_widget</span><span class="o">.</span><span class="n">hideable_widget</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="n">show</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">show</span><span class="p">:</span>
            <span class="n">icon</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QIcon</span><span class="p">()</span>
            <span class="n">icon</span><span class="o">.</span><span class="n">addPixmap</span><span class="p">(</span>
                <span class="n">QtGui</span><span class="o">.</span><span class="n">QPixmap</span><span class="p">(</span><span class="n">_fromUtf8</span><span class="p">(</span><span class="s2">&quot;:/soma_widgets_icons/nav_right&quot;</span><span class="p">)),</span>
                <span class="n">QtGui</span><span class="o">.</span><span class="n">QIcon</span><span class="o">.</span><span class="n">Normal</span><span class="p">,</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QIcon</span><span class="o">.</span><span class="n">Off</span><span class="p">)</span>
            <span class="n">group_widget</span><span class="o">.</span><span class="n">fold_button</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">icon</span><span class="p">)</span>

        <span class="c1">#group_widget.fold_button.clicked.connect(SomaPartial(</span>
            <span class="c1">#self._toggle_group_visibility, group))</span>
        <span class="c1"># FIXME: if we use this, self gets deleted somewhere. This is not</span>
        <span class="c1"># normal.</span>
        <span class="n">group_widget</span><span class="o">.</span><span class="n">fold_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">partial</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">_toggle_group_visibility</span><span class="p">,</span> <span class="n">weak_proxy</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">group</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">group_widget</span>

    <span class="k">def</span> <span class="nf">_set_group_visibility</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">checked</span><span class="p">):</span>
        <span class="n">group_widget</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_groups</span><span class="p">[</span><span class="n">group</span><span class="p">]</span>
        <span class="n">group_widget</span><span class="o">.</span><span class="n">hideable_widget</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="n">checked</span><span class="p">)</span>
        <span class="n">icon</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QIcon</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">checked</span><span class="p">:</span>
            <span class="n">icon</span><span class="o">.</span><span class="n">addPixmap</span><span class="p">(</span>
                <span class="n">QtGui</span><span class="o">.</span><span class="n">QPixmap</span><span class="p">(</span><span class="n">_fromUtf8</span><span class="p">(</span><span class="s2">&quot;:/soma_widgets_icons/nav_down&quot;</span><span class="p">)),</span>
                <span class="n">QtGui</span><span class="o">.</span><span class="n">QIcon</span><span class="o">.</span><span class="n">Normal</span><span class="p">,</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QIcon</span><span class="o">.</span><span class="n">Off</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">icon</span><span class="o">.</span><span class="n">addPixmap</span><span class="p">(</span>
                <span class="n">QtGui</span><span class="o">.</span><span class="n">QPixmap</span><span class="p">(</span><span class="n">_fromUtf8</span><span class="p">(</span><span class="s2">&quot;:/soma_widgets_icons/nav_right&quot;</span><span class="p">)),</span>
                <span class="n">QtGui</span><span class="o">.</span><span class="n">QIcon</span><span class="o">.</span><span class="n">Normal</span><span class="p">,</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QIcon</span><span class="o">.</span><span class="n">Off</span><span class="p">)</span>
        <span class="n">group_widget</span><span class="o">.</span><span class="n">fold_button</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">icon</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_toggle_group_visibility</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">checked</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">visible_groups</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="p">,</span> <span class="s1">&#39;visible_groups&#39;</span><span class="p">,</span> <span class="nb">set</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">visible_groups</span><span class="p">:</span>
            <span class="n">show</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">visible_groups</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">show</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">visible_groups</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_group_visibility</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">show</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">visible_groups</span> <span class="o">=</span> <span class="n">visible_groups</span>

    <span class="k">def</span> <span class="nf">_create_control_in_layout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trait_name</span><span class="p">,</span> <span class="n">trait</span><span class="p">,</span> <span class="n">layout</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># Call the search function that will map the trait type to the</span>
        <span class="c1"># corresponding control type</span>
        <span class="n">control_class</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_control_class</span><span class="p">(</span><span class="n">trait</span><span class="p">)</span>
        <span class="c1">## FIXME: for now we use a hack for compound/either traits, until</span>
        <span class="c1">## we write a &quot;real&quot; GUI for them</span>
        <span class="c1">#if isinstance(trait.trait_type, (traits.TraitCompound, traits.Either)):</span>
            <span class="c1">## compound trait: use the 1st</span>
            <span class="c1">#trait = trait.handler.handlers[0].as_ctrait()</span>
        <span class="c1"># Create the control instance and associated label</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">editable_labels</span><span class="p">:</span>
            <span class="n">label_class</span> <span class="o">=</span> <span class="n">DeletableLineEdit</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">label_class</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span>
        <span class="n">control_instance</span><span class="p">,</span> <span class="n">control_label</span> <span class="o">=</span> <span class="n">control_class</span><span class="o">.</span><span class="n">create_widget</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">trait_name</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="p">,</span> <span class="n">trait_name</span><span class="p">),</span>
            <span class="n">trait</span><span class="p">,</span> <span class="n">label_class</span><span class="p">,</span> <span class="n">user_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">user_data</span><span class="p">)</span>
        <span class="n">control_class</span><span class="o">.</span><span class="n">is_valid</span><span class="p">(</span><span class="n">control_instance</span><span class="p">)</span>

        <span class="c1"># If the trait contains a description, insert a tool tip to the</span>
        <span class="c1"># control instance</span>
        <span class="n">type_name</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">trait</span><span class="o">.</span><span class="n">trait_type</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1">#protected = &#39;&#39;</span>
        <span class="c1">#if self.controller.is_parameter_protected(trait_name):</span>
            <span class="c1">#protected = &#39; - modified&#39;</span>
        <span class="n">tooltip</span> <span class="o">=</span> <span class="s2">&quot;&lt;b&gt;</span><span class="si">%s</span><span class="s2">&lt;/b&gt; (</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">trait_name</span><span class="p">,</span> <span class="n">type_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">trait</span><span class="o">.</span><span class="n">desc</span><span class="p">:</span>
            <span class="n">tooltip</span> <span class="o">+=</span> <span class="s2">&quot;&lt;b&gt;:&lt;/b&gt; &quot;</span> <span class="o">+</span> <span class="n">trait</span><span class="o">.</span><span class="n">desc</span>
        <span class="k">if</span> <span class="n">control_label</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">control_label</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                <span class="n">control_label</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="n">tooltip</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">control_label</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="n">tooltip</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">control_instance</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="n">tooltip</span><span class="p">)</span>

        <span class="c1"># Get the last empty row in the grid layout</span>
        <span class="c1"># Trick: If the grid layout is empty check the element 0</span>
        <span class="c1"># (not realistic but te grid layout return None)</span>
        <span class="n">last_row</span> <span class="o">=</span> <span class="n">layout</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()</span>
        <span class="n">widget_item</span> <span class="o">=</span> <span class="n">layout</span><span class="o">.</span><span class="n">itemAtPosition</span><span class="p">(</span><span class="n">last_row</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">widget_item</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">last_row</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">last_row</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="n">widget_item</span> <span class="o">=</span> <span class="n">layout</span><span class="o">.</span><span class="n">itemAtPosition</span><span class="p">(</span><span class="n">last_row</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">last_row</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># If the control has no label, append the control in a two</span>
        <span class="c1"># columns span area of the grid layout</span>
        <span class="k">if</span> <span class="n">control_label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

            <span class="c1"># Grid layout &#39;addWidget&#39; parameters: QWidget, int row,</span>
            <span class="c1"># int column, int rowSpan, int columnSpan</span>
            <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span>
                <span class="n">control_instance</span><span class="p">,</span> <span class="n">last_row</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="c1"># If the control has two labels, add a first row with the</span>
        <span class="c1"># labels (one per column), and add the control in</span>
        <span class="c1"># the next row of the grid layout in the second column</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">control_label</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>

            <span class="c1"># Get the number of label</span>
            <span class="n">nb_of_labels</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">control_label</span><span class="p">)</span>

            <span class="c1"># If more than two labels are detected, print an error message.</span>
            <span class="c1"># We actually consider only the two first labels and skip the</span>
            <span class="c1"># others</span>
            <span class="k">if</span> <span class="n">nb_of_labels</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;To many labels associated with control &quot;</span>
                              <span class="s2">&quot;&#39;</span><span class="si">{0}</span><span class="s2">&#39;: </span><span class="si">{1}</span><span class="s2">. Only consider the two first &quot;</span>
                              <span class="s2">&quot;labels and skip the others&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                  <span class="n">trait_name</span><span class="p">,</span> <span class="n">control_label</span><span class="p">))</span>

            <span class="c1"># Append each label in different columns</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hide_labels</span><span class="p">:</span>
                <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span>
                    <span class="n">control_label</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">last_row</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">nb_of_labels</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">control_label</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">last_row</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

            <span class="c1"># Append the control in the next row in the second column</span>
            <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">control_instance</span><span class="p">,</span> <span class="n">last_row</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Otherwise, append the label and control in two separate</span>
        <span class="c1"># columns of the grid layout</span>
        <span class="k">else</span><span class="p">:</span>

            <span class="c1"># Append the label in the first column</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hide_labels</span><span class="p">:</span>
                <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">control_label</span><span class="p">,</span> <span class="n">last_row</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

            <span class="c1"># Append the control in the second column</span>
            <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span>
                <span class="n">control_instance</span><span class="p">,</span> <span class="n">last_row</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Store some informations about the inserted control in the</span>
        <span class="c1"># private &#39;_controls&#39; class parameter</span>
        <span class="c1"># Keys: the trait names</span>
        <span class="c1"># Parameters: the trait - the control name - the control - and</span>
        <span class="c1"># the labels associated with the control</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_controls</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">trait_name</span><span class="p">,</span> <span class="p">{})[</span><span class="n">group</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">trait</span><span class="p">,</span> <span class="n">control_class</span><span class="p">,</span> <span class="n">control_instance</span><span class="p">,</span> <span class="n">control_label</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">control_instance</span><span class="p">,</span> <span class="n">control_label</span>

    <span class="k">def</span> <span class="nf">_key_modified</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">old_key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Dict / open controller key modification callback</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">control_groups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_controls</span><span class="p">[</span><span class="n">old_key</span><span class="p">]</span>
        <span class="n">control_labels</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">group_name</span><span class="p">,</span> <span class="n">control</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="n">control_groups</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;group_name:&#39;</span><span class="p">,</span> <span class="n">group_name</span><span class="p">,</span> <span class="s1">&#39;, control:&#39;</span><span class="p">,</span> <span class="n">control</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">control</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">control_labels</span> <span class="o">+=</span> <span class="n">control</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">control_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">control</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
        <span class="n">key</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">control_label</span> <span class="ow">in</span> <span class="n">control_labels</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">control_label</span><span class="p">,</span> <span class="s1">&#39;text&#39;</span><span class="p">):</span>
                <span class="n">key</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">control_label</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
                <span class="n">was_connected</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connected</span>
                <span class="k">if</span> <span class="n">was_connected</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">disconnect_keys</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Modified dict key widget cannot be found&#39;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">controller</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;add trait on:&#39;</span><span class="p">,</span> <span class="n">controller</span><span class="p">)</span>
        <span class="n">trait</span> <span class="o">=</span> <span class="n">controller</span><span class="o">.</span><span class="n">trait</span><span class="p">(</span><span class="n">old_key</span><span class="p">)</span>
        <span class="n">controller</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">trait</span><span class="p">)</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="n">old_key</span><span class="p">))</span>
        <span class="n">controller</span><span class="o">.</span><span class="n">remove_trait</span><span class="p">(</span><span class="n">old_key</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_controls</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_controls</span><span class="p">[</span><span class="n">old_key</span><span class="p">]</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_controls</span><span class="p">[</span><span class="n">old_key</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">was_connected</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
        <span class="c1"># reconnect label widget</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect_keys</span><span class="p">()</span>
        <span class="c1"># self.update_controls()  # not even needed</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;main_controller_def&#39;</span><span class="p">):</span>
            <span class="n">main_control_class</span><span class="p">,</span> <span class="n">controller_widget</span><span class="p">,</span> <span class="n">control_name</span><span class="p">,</span> <span class="n">frame</span> <span class="o">=</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">main_controller_def</span>
            <span class="n">main_control_class</span><span class="o">.</span><span class="n">update_controller</span><span class="p">(</span>
                <span class="n">controller_widget</span><span class="p">,</span> <span class="n">control_name</span><span class="p">,</span> <span class="n">frame</span><span class="p">)</span>
        <span class="c1"># self.update_controller()</span>

    <span class="k">def</span> <span class="nf">_delete_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Dict / open controller key deletion callback</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">controller</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span>
        <span class="n">trait</span> <span class="o">=</span> <span class="n">controller</span><span class="o">.</span><span class="n">trait</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="n">controller</span><span class="o">.</span><span class="n">remove_trait</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_controls</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;main_controller_def&#39;</span><span class="p">):</span>
            <span class="n">main_control_class</span><span class="p">,</span> <span class="n">controller_widget</span><span class="p">,</span> <span class="n">control_name</span><span class="p">,</span> <span class="n">frame</span> <span class="o">=</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">main_controller_def</span>
            <span class="n">main_control_class</span><span class="o">.</span><span class="n">update_controller</span><span class="p">(</span>
                <span class="n">controller_widget</span><span class="p">,</span> <span class="n">control_name</span><span class="p">,</span> <span class="n">frame</span><span class="p">)</span>
        <span class="c1"># self.update_controller()</span>

    <span class="k">def</span> <span class="nf">groups_vibility_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">visible_groups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">visible_groups</span> <span class="ow">or</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">group</span><span class="p">,</span> <span class="n">group_widget</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_groups</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">visible_groups</span><span class="p">:</span>
                <span class="n">show</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">show</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_group_visibility</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">show</span><span class="p">)</span>

<div class="viewcode-block" id="ControllerWidget.get_control_class"><a class="viewcode-back" href="../../../api.html#soma.qt_gui.controller_widget.ControllerWidget.get_control_class">[docs]</a>    <span class="k">def</span> <span class="nf">get_control_class</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trait</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Find the control associated with the input trait.</span>

<span class="sd">        The mapping is defined in the global class parameter</span>
<span class="sd">        &#39;_defined_controls&#39;.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        trait: Trait (mandatory)</span>
<span class="sd">            a trait item</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        control_class: class</span>
<span class="sd">            the control class associated with the input trait.</span>
<span class="sd">            If no match has been found, return None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Initilaize the output variable</span>
        <span class="n">control_class</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">todo</span> <span class="o">=</span> <span class="p">[</span><span class="n">trait</span><span class="p">]</span>
        <span class="n">done</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">while</span> <span class="n">todo</span><span class="p">:</span>
            <span class="n">trait</span> <span class="o">=</span> <span class="n">todo</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">done</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">trait</span><span class="p">)</span>

            <span class="n">trait_id</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">ids</span> <span class="o">=</span> <span class="n">trait_ids</span><span class="p">(</span><span class="n">trait</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ids</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">trait_id</span> <span class="o">=</span> <span class="s1">&#39;Compound&#39;</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">ids</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">trait_id</span> <span class="o">=</span> <span class="n">ids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">trait_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">control_class</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_defined_controls</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">trait_id</span><span class="p">)</span>
                <span class="c1"># Recursive construction: consider only the top level</span>
                <span class="k">while</span> <span class="n">control_class</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">split_id</span> <span class="o">=</span> <span class="n">trait_id</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">split_id</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="k">break</span>
                    <span class="n">trait_id</span> <span class="o">=</span> <span class="n">split_id</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="c1"># Try to get the control class</span>
                    <span class="n">control_class</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_defined_controls</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">trait_id</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">control_class</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">break</span>

            <span class="c1"># not found: look in superclasses</span>
            <span class="n">bases</span> <span class="o">=</span> <span class="n">trait</span><span class="o">.</span><span class="n">trait_type</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__bases__</span> \
                <span class="o">+</span> <span class="n">trait</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__bases__</span>
            <span class="k">for</span> <span class="n">base</span> <span class="ow">in</span> <span class="n">bases</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">traits</span><span class="o">.</span><span class="n">TraitType</span><span class="p">):</span>
                    <span class="n">trait</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_instantiate_trait</span><span class="p">(</span><span class="n">base</span><span class="p">)</span>
                    <span class="n">todo</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">trait</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">control_class</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># fallback to a label displaying &quot;this value cannot be seen/edited&quot;</span>
            <span class="n">control_class</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_defined_controls</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;unknown&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isfunction</span><span class="p">(</span><span class="n">control_class</span><span class="p">):</span>
            <span class="c1"># the function may instantiate a specialized type dynamically</span>
            <span class="n">control_class</span> <span class="o">=</span> <span class="n">control_class</span><span class="p">(</span><span class="n">trait</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">control_class</span></div>

    <span class="k">def</span> <span class="nf">_instantiate_trait</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trait_type</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">trait_type</span><span class="p">,</span> <span class="n">traits</span><span class="o">.</span><span class="n">BaseRange</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">trait_type</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">trait_type</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_label_context_menu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">widget</span><span class="p">,</span> <span class="n">control_name</span><span class="p">,</span> <span class="n">pos</span><span class="p">):</span>
        <span class="n">menu</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QMenu</span><span class="p">(</span><span class="n">control_name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">protect</span> <span class="o">=</span> <span class="n">menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> modified&#39;</span> <span class="o">%</span> <span class="n">control_name</span><span class="p">)</span>
        <span class="n">protect</span><span class="o">.</span><span class="n">setCheckable</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">protected</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">is_parameter_protected</span><span class="p">(</span><span class="n">control_name</span><span class="p">)</span>
        <span class="n">protect</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="n">protected</span><span class="p">)</span>

        <span class="n">menu</span><span class="o">.</span><span class="n">exec_</span><span class="p">(</span><span class="n">widget</span><span class="p">()</span><span class="o">.</span><span class="n">mapToGlobal</span><span class="p">(</span><span class="n">pos</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">protect</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span> <span class="o">!=</span> <span class="n">protected</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">protect_parameter</span><span class="p">(</span><span class="n">control_name</span><span class="p">,</span>
                                              <span class="n">protect</span><span class="o">.</span><span class="n">isChecked</span><span class="p">())</span></div>


<span class="kn">from</span> <span class="nn">soma.qt_gui.controls</span> <span class="kn">import</span> <span class="n">controls</span>

<span class="c1"># Fill the controller widget mapping between the string trait descriptions and</span>
<span class="c1"># the associated control classes</span>
<span class="n">ControllerWidget</span><span class="o">.</span><span class="n">_defined_controls</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">controls</span><span class="p">)</span>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">Soma-base 5.1.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">soma.qt_gui.controller_widget</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2011, IFR49.org.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.5.4.
    </div>
  </body>
</html>